<!DOCTYPE html>
<html>
<head>
  <title>Stevo Circle Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/@svgdotjs/svg.js@3.0/dist/svg.min.js"></script>
</head>
<body>
 
    <div id="circle-container">
    </div>
</body>
<script>

  SVG.on(document, 'DOMContentLoaded', async function() {
    // initialize SVG.js
    var diameter = 300;
    var rectSize = 20;
    var oddAdd = 1;
    var boundLength = (diameter) + 1 + oddAdd;
    var draw = SVG().addTo('#circle-container').size(boundLength*rectSize ,boundLength*rectSize);
    
    if(diameter % 2 != 0){
      oddAdd = 0;
      diameter = diameter - 1
    }else{
      diameter = diameter - 2
    }
    var r = diameter / 2 ;
    
    
    var boundLengthHalf = Math.floor(boundLength/2);
    
    draw.rect(rectSize*boundLength, rectSize*boundLength).fill('#baa');

    for(var x = 0; x < boundLength; x++){
      for(var y = 0; y < boundLength; y++){
        draw.rect(rectSize-2, rectSize-2).move(1+(x*rectSize), 1+(y*rectSize)).fill('#ccc');
      }
    }
    let xb =  0;
    let yb = r;
    let d = 3 - (2 * r);
    draw8way(draw,boundLengthHalf,boundLengthHalf,xb,yb,oddAdd,rectSize,'#f6c');
    let startX, startY = 0;
    let count, prevCount = 0;
    let prevStartX, prevStartY = 0;
    while(xb <= yb){
      if(d > 0){
        yb--;
        d=d+(4*xb)-(4*yb)+10;  
        if(startY != 0){
          // drawSquare(draw,startX,startY,rectSize,'#fba');
          // draw.rect(10,10).move(startX+boundLengthHalf*rectSize, startY+boundLengthHalf*rectSize).fill('#afa');
          let tscal = 0;// count >=1  ? rectSize : 0;
          if( prevCount < count){
            var polygon = draw.polygon([prevStartX+(boundLengthHalf*rectSize)-tscal,
                                        startY+(boundLengthHalf*rectSize),
                                        prevStartX+(boundLengthHalf*rectSize)+(startX-prevStartX+count*rectSize)-tscal,
                                        startY+(boundLengthHalf*rectSize),
                                        prevStartX+(boundLengthHalf*rectSize)-tscal,
                                        prevStartY+(boundLengthHalf*rectSize)+rectSize])
                                        .fill('#afa').stroke({ width: 1 });
            }
            else if( prevCount == count){
            var polygon = draw.polygon([prevStartX+(boundLengthHalf*rectSize)-tscal,
                                        startY+(boundLengthHalf*rectSize),
                                        prevStartX+(boundLengthHalf*rectSize)+(startX-prevStartX+count*rectSize)-tscal,
                                        startY+(boundLengthHalf*rectSize),
                                        prevStartX+(boundLengthHalf*rectSize)-tscal,
                                        prevStartY+(boundLengthHalf*rectSize)+rectSize])
                                        .fill('#57c').stroke({ width: 1 });
            }
           else {
            var polygon = draw.polygon([startX+boundLengthHalf*rectSize-tscal,
                                        startY+boundLengthHalf*rectSize,
                                        startX+boundLengthHalf*rectSize+(rectSize*count)-tscal,
                                        startY+boundLengthHalf*rectSize,
                                        startX+boundLengthHalf*rectSize-tscal,
                                        startY+boundLengthHalf*rectSize+rectSize])
                                        .fill('#aff').stroke({ width: 1 });
            }
          }

          
          if(prevCount > count){
            prevStartX = startX;
            prevStartY = startY;

          }

          startY = (yb+1)*rectSize;
          startX = (xb+1)*rectSize;
          prevCount = count;
          count = 0;
      } else {
        // count++;
        d = d+(4*xb)+6;
      }
      xb++;
      count++;
      console.log('x: '+xb+' y: '+yb);
      // drawSquare(draw,xb + boundLengthHalf,yb + boundLengthHalf,rectSize,'#f06');
      draw8way(draw,boundLengthHalf,boundLengthHalf,xb,yb,oddAdd,rectSize,'#d06');
      await new Promise(r => setTimeout(r,33));
    }


    drawSquare(draw,0,0,rectSize,'#afa');
    draw.circle((rectSize)*(diameter)+(rectSize*(1+oddAdd))).fill({ color: '#fff', opacity: 0.0 }).stroke({ color: '#1AA', opacity: 1, width: 2 }).move(rectSize*1,rectSize*1);
    draw.rect(0,0).move(0, 0).fill('#afa');
  });

  function drawSquare(svgRenderer,x,y,rectSize,color){
    svgRenderer.rect(rectSize-2, rectSize-2).move(1+(x*rectSize), 1+(y*rectSize)).fill(color);
  }

  function draw8way(svgRenderer,xc,yc,x,y,oddAdd,rectSize,color){
    
      drawSquare(svgRenderer,x+xc,y+yc,rectSize,color);  
    drawSquare(svgRenderer,x+xc,-y+yc-oddAdd,rectSize,color);  
    drawSquare(svgRenderer,-x+xc-oddAdd,-y+yc-oddAdd,rectSize,color);  
    drawSquare(svgRenderer,-x+xc-oddAdd,y+yc,rectSize,color);  
      drawSquare(svgRenderer,y+xc,x+yc,rectSize,color);  
    drawSquare(svgRenderer,y+xc,-x+yc-oddAdd,rectSize,color);  
    drawSquare(svgRenderer,-y+xc-oddAdd,-x+yc-oddAdd,rectSize,color);  
    drawSquare(svgRenderer,-y+xc-oddAdd,x+yc,rectSize,color);  
  }
</script>
</html>